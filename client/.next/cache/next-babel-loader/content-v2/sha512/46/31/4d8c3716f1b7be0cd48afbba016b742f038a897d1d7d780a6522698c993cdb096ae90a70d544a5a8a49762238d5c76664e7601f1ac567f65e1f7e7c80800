{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/zknock/Develop/localhost_web/client/components/main/hoc/withAuth.tsx\";\nimport axios from 'axios';\nimport React from 'react';\nimport SERVER from '../../../utils/url';\nimport { useAsync } from 'react-async'; // isLogined\n// 0: 아무나 볼 수 있음, 1: 로그인한 회원만 볼 수 있음, 2: 게스트만 볼 수 있음\n// grade\n// 0: 아무나 볼 수 있음, 2: 호스트회원만 볼 수 있음, 3: 관리자회원만 볼 수 있음\n\nconst getAuth = async () => {\n  const res = await axios.get(`${SERVER}/api/auth/check`, {\n    withCredentials: true\n  });\n  return res.data;\n};\n\nconst withAuth = (isLogined, grade) => Component => {\n  return () => {\n    const {\n      data,\n      isLoading,\n      error\n    } = useAsync({\n      promiseFn: getAuth\n    });\n    if (isLoading) return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\uB85C\\uB529\\uC911...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 25\n    }, this);\n    if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\uC5D0\\uB7EC!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 21\n    }, this);\n    if (!data) return null;\n    const user = data.user;\n\n    if (data.success) {\n      console.log('로그인되어있습니다.');\n\n      if (isLogined === 2) {\n        alert('이미 로그인되어있습니다.');\n        location.href = '/';\n      }\n\n      switch (grade) {\n        // 아무나\n        case 0:\n          return {\n            Component\n          };\n        // 호스트\n\n        case 1:\n          if (user.isHost) return Component;\n          alert('접근할 수 없는 페이지 입니다.');\n          location.href = '/';\n        // 관리자\n\n        case 2:\n          if (user.isAdmin) return Component;\n          alert('접근할 수 없는 페이지 입니다.');\n          location.href = '/';\n      }\n    } else {\n      // 로그인되지않음\n      console.log('로그인을 해주세요.');\n      console.log(data.message, '이것은 에러');\n\n      if (isLogined === 1) {\n        alert('로그인을 해주세요.');\n        location.href = '/login';\n      } else {\n        return Component;\n      }\n    }\n\n    return Component;\n  }; // axios\n  // \t.get(`${SERVER}/api/auth/check`, { withCredentials: true })\n  // \t.then(res => {\n  // \t\tconst user: User = res.data.user;\n  // \t\tif (res.data.success) {\n  // \t\t\tconsole.log('로그인되어있습니다.');\n  // \t\t\tif (isLogined === 2) {\n  // \t\t\t\talert('이미 로그인되어있습니다.');\n  // \t\t\t\tlocation.href = '/';\n  // \t\t\t}\n  // \t\t\tswitch (grade) {\n  // \t\t\t\t// 아무나\n  // \t\t\t\tcase 0:\n  // \t\t\t\t\treturn Component;\n  // \t\t\t\t// 호스트\n  // \t\t\t\tcase 1:\n  // \t\t\t\t\tif (user.isHost) return Component;\n  // \t\t\t\t\talert('접근할 수 없는 페이지 입니다.');\n  // \t\t\t\t\tlocation.href = '/';\n  // \t\t\t\t// 관리자\n  // \t\t\t\tcase 2:\n  // \t\t\t\t\tif (user.isAdmin) return Component;\n  // \t\t\t\t\talert('접근할 수 없는 페이지 입니다.');\n  // \t\t\t\t\tlocation.href = '/';\n  // \t\t\t}\n  // \t\t} else {\n  // \t\t\t// 로그인되지않음\n  // \t\t\tconsole.log('로그인을 해주세요.');\n  // \t\t\tconsole.log(res.data.message, '이것은 에러');\n  // \t\t\tif (isLogined === 1) {\n  // \t\t\t\talert('로그인을 해주세요.');\n  // \t\t\t\tlocation.href = '/login';\n  // \t\t\t} else {\n  // \t\t\t\treturn Component;\n  // \t\t\t}\n  // \t\t}\n  // \t});\n  // return Component;\n};\n\nexport default withAuth;","map":{"version":3,"sources":["/Users/zknock/Develop/localhost_web/client/components/main/hoc/withAuth.tsx"],"names":["axios","React","SERVER","useAsync","getAuth","res","get","withCredentials","data","withAuth","isLogined","grade","Component","isLoading","error","promiseFn","user","success","console","log","alert","location","href","isHost","isAdmin","message"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAiC,OAAjC;AACA,OAAOC,MAAP,MAAmB,oBAAnB;AAGA,SAASC,QAAT,QAAyB,aAAzB,C,CAEA;AACA;AAEA;AACA;;AAEA,MAAMC,OAAO,GAAG,YAAY;AAC3B,QAAMC,GAAG,GAAG,MAAML,KAAK,CAACM,GAAN,CAAW,GAAEJ,MAAO,iBAApB,EAAsC;AACvDK,IAAAA,eAAe,EAAE;AADsC,GAAtC,CAAlB;AAIA,SAAOF,GAAG,CAACG,IAAX;AACA,CAND;;AAQA,MAAMC,QAAQ,GAAG,CAACC,SAAD,EAAoBC,KAApB,KAChBC,SADsD,IAElD;AACJ,SAAO,MAAM;AACZ,UAAM;AAAEJ,MAAAA,IAAF;AAAQK,MAAAA,SAAR;AAAmBC,MAAAA;AAAnB,QAA6BX,QAAQ,CAAC;AAC3CY,MAAAA,SAAS,EAAEX;AADgC,KAAD,CAA3C;AAIA,QAAIS,SAAJ,EAAe,oBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAP;AACf,QAAIC,KAAJ,EAAW,oBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAP;AACX,QAAI,CAACN,IAAL,EAAW,OAAO,IAAP;AAEX,UAAMQ,IAAU,GAAGR,IAAI,CAACQ,IAAxB;;AACA,QAAIR,IAAI,CAACS,OAAT,EAAkB;AACjBC,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;;AACA,UAAIT,SAAS,KAAK,CAAlB,EAAqB;AACpBU,QAAAA,KAAK,CAAC,eAAD,CAAL;AACAC,QAAAA,QAAQ,CAACC,IAAT,GAAgB,GAAhB;AACA;;AACD,cAAQX,KAAR;AACC;AACA,aAAK,CAAL;AACC,iBAAO;AAAEC,YAAAA;AAAF,WAAP;AACD;;AACA,aAAK,CAAL;AACC,cAAII,IAAI,CAACO,MAAT,EAAiB,OAAOX,SAAP;AACjBQ,UAAAA,KAAK,CAAC,mBAAD,CAAL;AACAC,UAAAA,QAAQ,CAACC,IAAT,GAAgB,GAAhB;AACD;;AACA,aAAK,CAAL;AACC,cAAIN,IAAI,CAACQ,OAAT,EAAkB,OAAOZ,SAAP;AAClBQ,UAAAA,KAAK,CAAC,mBAAD,CAAL;AACAC,UAAAA,QAAQ,CAACC,IAAT,GAAgB,GAAhB;AAbF;AAeA,KArBD,MAqBO;AACN;AACAJ,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYX,IAAI,CAACiB,OAAjB,EAA0B,QAA1B;;AAEA,UAAIf,SAAS,KAAK,CAAlB,EAAqB;AACpBU,QAAAA,KAAK,CAAC,YAAD,CAAL;AACAC,QAAAA,QAAQ,CAACC,IAAT,GAAgB,QAAhB;AACA,OAHD,MAGO;AACN,eAAOV,SAAP;AACA;AACD;;AAED,WAAOA,SAAP;AACA,GA7CD,CADI,CAgDJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,CA1FD;;AA4FA,eAAeH,QAAf","sourcesContent":["import axios from 'axios';\nimport React, { ReactNode } from 'react';\nimport SERVER from '../../../utils/url';\nimport Router from 'next/router';\nimport { User } from '../../../interfaces';\nimport { useAsync } from 'react-async';\n\n// isLogined\n// 0: 아무나 볼 수 있음, 1: 로그인한 회원만 볼 수 있음, 2: 게스트만 볼 수 있음\n\n// grade\n// 0: 아무나 볼 수 있음, 2: 호스트회원만 볼 수 있음, 3: 관리자회원만 볼 수 있음\n\nconst getAuth = async () => {\n\tconst res = await axios.get(`${SERVER}/api/auth/check`, {\n\t\twithCredentials: true,\n\t});\n\n\treturn res.data;\n};\n\nconst withAuth = (isLogined: number, grade: number) => (\n\tComponent: ReactNode,\n) => {\n\treturn () => {\n\t\tconst { data, isLoading, error } = useAsync({\n\t\t\tpromiseFn: getAuth,\n\t\t});\n\n\t\tif (isLoading) return <div>로딩중...</div>;\n\t\tif (error) return <div>에러!</div>;\n\t\tif (!data) return null;\n\n\t\tconst user: User = data.user;\n\t\tif (data.success) {\n\t\t\tconsole.log('로그인되어있습니다.');\n\t\t\tif (isLogined === 2) {\n\t\t\t\talert('이미 로그인되어있습니다.');\n\t\t\t\tlocation.href = '/';\n\t\t\t}\n\t\t\tswitch (grade) {\n\t\t\t\t// 아무나\n\t\t\t\tcase 0:\n\t\t\t\t\treturn { Component };\n\t\t\t\t// 호스트\n\t\t\t\tcase 1:\n\t\t\t\t\tif (user.isHost) return Component;\n\t\t\t\t\talert('접근할 수 없는 페이지 입니다.');\n\t\t\t\t\tlocation.href = '/';\n\t\t\t\t// 관리자\n\t\t\t\tcase 2:\n\t\t\t\t\tif (user.isAdmin) return Component;\n\t\t\t\t\talert('접근할 수 없는 페이지 입니다.');\n\t\t\t\t\tlocation.href = '/';\n\t\t\t}\n\t\t} else {\n\t\t\t// 로그인되지않음\n\t\t\tconsole.log('로그인을 해주세요.');\n\t\t\tconsole.log(data.message, '이것은 에러');\n\n\t\t\tif (isLogined === 1) {\n\t\t\t\talert('로그인을 해주세요.');\n\t\t\t\tlocation.href = '/login';\n\t\t\t} else {\n\t\t\t\treturn Component;\n\t\t\t}\n\t\t}\n\n\t\treturn Component;\n\t};\n\n\t// axios\n\t// \t.get(`${SERVER}/api/auth/check`, { withCredentials: true })\n\t// \t.then(res => {\n\t// \t\tconst user: User = res.data.user;\n\t// \t\tif (res.data.success) {\n\t// \t\t\tconsole.log('로그인되어있습니다.');\n\t// \t\t\tif (isLogined === 2) {\n\t// \t\t\t\talert('이미 로그인되어있습니다.');\n\t// \t\t\t\tlocation.href = '/';\n\t// \t\t\t}\n\t// \t\t\tswitch (grade) {\n\t// \t\t\t\t// 아무나\n\t// \t\t\t\tcase 0:\n\t// \t\t\t\t\treturn Component;\n\t// \t\t\t\t// 호스트\n\t// \t\t\t\tcase 1:\n\t// \t\t\t\t\tif (user.isHost) return Component;\n\t// \t\t\t\t\talert('접근할 수 없는 페이지 입니다.');\n\t// \t\t\t\t\tlocation.href = '/';\n\t// \t\t\t\t// 관리자\n\t// \t\t\t\tcase 2:\n\t// \t\t\t\t\tif (user.isAdmin) return Component;\n\t// \t\t\t\t\talert('접근할 수 없는 페이지 입니다.');\n\t// \t\t\t\t\tlocation.href = '/';\n\t// \t\t\t}\n\t// \t\t} else {\n\t// \t\t\t// 로그인되지않음\n\t// \t\t\tconsole.log('로그인을 해주세요.');\n\t// \t\t\tconsole.log(res.data.message, '이것은 에러');\n\n\t// \t\t\tif (isLogined === 1) {\n\t// \t\t\t\talert('로그인을 해주세요.');\n\t// \t\t\t\tlocation.href = '/login';\n\t// \t\t\t} else {\n\t// \t\t\t\treturn Component;\n\t// \t\t\t}\n\t// \t\t}\n\t// \t});\n\n\t// return Component;\n};\n\nexport default withAuth;\n"]},"metadata":{},"sourceType":"module"}